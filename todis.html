<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TODIS - Dark Party</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>

    <style>
        body {
            margin: 0; overflow: hidden;
            background-color: #000;
            background: radial-gradient(circle at center, #1a0524 0%, #000000 100%);
            font-family: 'Montserrat', sans-serif;
            color: white; 
            /* Altura din√°mica para m√≥viles */
            height: 100dvh; 
            width: 100vw;
            display: flex; flex-direction: column; align-items: center;
            /* Evita zoom accidental al tocar r√°pido */
            touch-action: none;
        }

        #game-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 5; }

        /* --- FONDO DARK PARTY --- */
        .party-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; pointer-events: none; overflow: hidden;
        }

        .spotlight {
            position: absolute; top: 50%; left: 50%; width: 200vmax; height: 200vmax;
            transform: translate(-50%, -50%);
            background: conic-gradient(from 0deg, transparent 0deg, rgba(138, 43, 226, 0.1) 20deg, transparent 40deg, transparent 180deg, rgba(0, 255, 255, 0.05) 200deg, transparent 220deg);
            animation: rotate-lights 20s linear infinite; pointer-events: none;
        }
        .spotlight-2 {
            animation: rotate-lights 30s linear infinite reverse; opacity: 0.7;
            background: conic-gradient(from 180deg, transparent 0deg, rgba(255, 0, 128, 0.08) 30deg, transparent 60deg);
        }
        .ambient-blob {
            position: absolute; border-radius: 50%; filter: blur(100px); opacity: 0.3;
            animation: float-blob 15s infinite ease-in-out alternate;
        }
        .b1 { top: -20%; left: -20%; width: 60vw; height: 60vw; background: #4b0082; }
        .b2 { bottom: -20%; right: -20%; width: 70vw; height: 70vw; background: #00008b; animation-delay: -5s; }

        @keyframes rotate-lights { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }
        @keyframes float-blob { 0% { transform: translate(0,0); opacity: 0.2; } 100% { transform: translate(50px, 50px); opacity: 0.4; } }

        /* --- UI DE VIDRIO --- */
        .glass-panel {
            background: rgba(10, 10, 10, 0.6); backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.8);
        }

        /* --- T√çTULO --- */
        .header { position: absolute; top: 5vh; z-index: 10; text-align: center; width: 100%; pointer-events: none; }
        .header h1 {
            font-size: 4.5rem; margin: 0; letter-spacing: 5px; color: #fff;
            text-transform: uppercase; font-weight: 900;
            text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 20px #bc13fe, 0 0 40px #bc13fe, 0 0 80px #bc13fe;
            animation: flicker 10s infinite alternate;
        }
        
        @keyframes flicker {
            0%, 18%, 22%, 25%, 53%, 57%, 100% { opacity: 1; }
            20%, 24%, 55% { opacity: 0.5; text-shadow: none; }
        }

        /* --- BOT√ìN LANZAR --- */
        #roll-btn {
            position: absolute; bottom: 5vh; z-index: 10;
            padding: 20px 80px; font-size: 1.5rem; font-weight: 900;
            text-transform: uppercase; color: #fff;
            background: linear-gradient(90deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.1) 100%);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 60px; cursor: pointer; backdrop-filter: blur(10px);
            transition: all 0.3s; box-shadow: 0 0 20px rgba(0,0,0,0.5);
            letter-spacing: 3px; text-shadow: 0 0 10px rgba(255,255,255,0.3);
            -webkit-tap-highlight-color: transparent; /* Quita el flash azul en m√≥viles */
        }
        #roll-btn:hover { background: #fff; color: #000; transform: scale(1.05); box-shadow: 0 0 50px rgba(188, 19, 254, 0.5); }
        #roll-btn:active { transform: scale(0.95); }

        /* --- RESULTADO --- */
        #result-card {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            width: 85%; max-width: 450px;
            padding: 30px; text-align: center;
            z-index: 20; opacity: 0; pointer-events: none;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #result-card.active { opacity: 1; transform: translate(-50%, -50%) scale(1); pointer-events: auto; }

        #result-number { font-size: 5rem; font-weight: 900; margin: 0; line-height: 1; text-shadow: 0 0 30px currentColor; }
        #result-title { font-size: 2rem; font-weight: 700; margin: 15px 0; text-transform: uppercase; letter-spacing: -1px; }
        #result-desc { font-size: 1.2rem; line-height: 1.5; color: #ccc; }
        
        .extra-box {
            margin-top: 25px; padding: 15px;
            background: rgba(0,0,0,0.6); border-radius: 10px;
            border-left: 4px solid #ffd700; display: none;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }
        .extra-label { font-size: 0.7rem; color: #aaa; text-transform: uppercase; letter-spacing: 2px; }
        .extra-text { font-size: 1rem; margin-top: 5px; color: #ffd700; font-weight: bold; }

        .highlight { color: #00ffff; text-shadow: 0 0 10px #00ffff; }
        .danger { color: #ff0055; text-shadow: 0 0 10px #ff0055; }

        /* --- MEDIA QUERIES PARA CELULARES --- */
        @media (max-width: 768px) {
            .header h1 { font-size: 3rem; }
            .header { top: 30px; }
            
            #result-number { font-size: 4rem; }
            #result-title { font-size: 1.5rem; margin: 10px 0; }
            #result-desc { font-size: 1rem; }
            
            #roll-btn {
                padding: 20px 40px;
                width: 80%; /* Bot√≥n m√°s ancho en celular */
                font-size: 1.2rem;
                bottom: 40px;
            }
            
            #result-card {
                width: 90%; /* Tarjeta m√°s ancha en celular */
                padding: 20px;
            }
        }
    </style>
</head>
<body>

    <div class="party-bg">
        <div class="ambient-blob b1"></div>
        <div class="ambient-blob b2"></div>
        <div class="spotlight"></div>
        <div class="spotlight spotlight-2"></div>
    </div>

    <div class="header">
        <h1>TODIS</h1>
    </div>

    <div id="game-canvas"></div>

    <div id="result-card" class="glass-panel">
        <div id="result-number">1</div>
        <div id="result-title">TITULO</div>
        <div id="result-desc">Descripci√≥n de la acci√≥n.</div>
        
        <div class="extra-box" id="extra-box">
            <div class="extra-label">ADICIONAL</div>
            <div class="extra-text" id="extra-text">...</div>
        </div>
    </div>

    <button id="roll-btn">LANZAR DADO</button>

<script>
    // --- REGLAS ---
    const rules = {
        1: { title: "ü§î TODOS O NADIE ü§î", desc: "T√∫ tienes el poder absoluto. <span class='highlight'>DECIDE:</span> ¬øTOMAN TODOS O NO TOMA NADIE?", color: "#ff0055", extra: null },
        2: { title: "üëø OBLIGAS üëø", desc: "Elige a una v√≠ctima de la mesa para que tome.", color: "#ffaa00", extra: "Decide el castigo: ¬øToma TODO o solo un SORBO?" },
        3: { title: "üëâ DERECHA üëâ", desc: "La persona a tu <span class='highlight'>DERECHA</span> debe tomar.", color: "#00aaff", extra: "Jueguen 'Piedra, Papel o Tijera'. Si √©l/ella pierde: ¬°TOMA TODO!" },
        4: { title: "üëà IZQUIERDA üëà", desc: "La persona a tu <span class='highlight'>IZQUIERDA</span> debe tomar.", color: "#aa00ff", extra: "Jueguen 'Piedra, Papel o Tijera'. Si √©l/ella pierde: ¬°TOMA TODO!" },
        5: { title: "üòÇ TOMAS SOL@ üòÇ", desc: "Mala suerte. <span class='danger'>Tomas t√∫ sol@.</span> Sin quejas.", color: "#ffffff", extra: null },
        6: { title: "ü´¢ POR ALGUIEN ü´¢", desc: "Di el nombre de alguien (presente o ausente). <span class='highlight'>Tomas por el/ella.</span>", color: "#00ff88", extra: "T√∫ decides tu propio destino: ¬øTomas TODO o un SORBO?" }
    };

    // --- THREE.JS ---
    const container = document.getElementById('game-canvas');
    const scene = new THREE.Scene();
    
    // C√°mara inicial
    const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
    adjustCamera(); // Ajuste inicial para m√≥viles

    const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // Optimizaci√≥n rendimiento
    container.appendChild(renderer.domElement);

    const ambientLight = new THREE.AmbientLight(0xffffff, 0.7); scene.add(ambientLight);
    const pL1 = new THREE.PointLight(0xff00ff, 1.5); pL1.position.set(-10, -10, 5); scene.add(pL1);
    const pL2 = new THREE.PointLight(0x00ffff, 1.5); pL2.position.set(10, 10, 5); scene.add(pL2);

    function createDiceTexture(n) {
        const c = document.createElement('canvas'); c.width = 256; c.height = 256;
        const x = c.getContext('2d');
        x.fillStyle = '#111'; x.fillRect(0,0,256,256);
        x.strokeStyle = '#333'; x.lineWidth = 10; x.strokeRect(5,5,246,246);
        x.fillStyle = '#fff'; x.shadowColor = '#00ffff'; x.shadowBlur = 20;
        const pos = {
            1:[[128,128]], 2:[[64,64],[192,192]], 3:[[64,64],[128,128],[192,192]],
            4:[[64,64],[192,64],[64,192],[192,192]], 5:[[64,64],[192,64],[128,128],[64,192],[192,192]],
            6:[[64,64],[192,64],[64,128],[192,128],[64,192],[192,192]]
        };
        pos[n].forEach(p => { x.beginPath(); x.arc(p[0], p[1], 25, 0, Math.PI*2); x.fill(); });
        return new THREE.CanvasTexture(c);
    }

    const mats = [1,6,2,5,3,4].map(n => new THREE.MeshStandardMaterial({
        map:createDiceTexture(n), roughness:0.2, metalness:0.1
    }));
    
    const dice = new THREE.Mesh(new THREE.BoxGeometry(3.5, 3.5, 3.5), mats);
    scene.add(dice);

    const rMap = { 
        1: {x:0, y:-Math.PI/2}, 6: {x:0, y:Math.PI/2}, 2: {x:Math.PI/2, y:0}, 
        5: {x:-Math.PI/2, y:0}, 3: {x:0, y:0}, 4: {x:Math.PI, y:0} 
    };

    let isRolling = false;
    const btn = document.getElementById('roll-btn');
    const card = document.getElementById('result-card');
    const extraBox = document.getElementById('extra-box');
    const extraText = document.getElementById('extra-text');

    function animate3D() {
        requestAnimationFrame(animate3D);
        if(!isRolling) { dice.rotation.x += 0.003; dice.rotation.y += 0.005; }
        renderer.render(scene, camera);
    }
    animate3D();

    btn.addEventListener('click', () => {
        if(isRolling) return;
        isRolling = true; btn.disabled = true;
        card.classList.remove('active');
        const res = Math.floor(Math.random()*6)+1;
        const target = rMap[res];
        
        gsap.to(dice.rotation, {
            duration: 2.0, x: target.x + Math.PI*6, y: target.y + Math.PI*6, z: 0,
            ease: "back.out(0.6)",
            onComplete: () => {
                isRolling = false; btn.disabled = false;
                dice.rotation.x = target.x; dice.rotation.y = target.y; dice.rotation.z = 0;
                showResult(res);
            }
        });
    });

    function showResult(n) {
        const d = rules[n];
        const numElem = document.getElementById('result-number');
        numElem.innerText = n; numElem.style.color = d.color;
        const titleElem = document.getElementById('result-title');
        titleElem.innerText = d.title; titleElem.style.color = d.color;
        document.getElementById('result-desc').innerHTML = d.desc;

        if (d.extra) { extraBox.style.display = 'block'; extraText.innerText = d.extra; }
        else { extraBox.style.display = 'none'; }

        card.classList.add('active');

        if (n === 6) triggerConfettiExplosion(['#00ffff', '#ff00ff', '#ffd700']);
        else if (n === 5) triggerEmojiRain('üç∫');
        else if (n === 2) triggerEmojiRain('üî•');
    }

    function triggerConfettiExplosion(colors) {
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: colors, disableForcedPhysics: true });
    }

    function triggerEmojiRain(emojiIcon) {
        const duration = 3000; const end = Date.now() + duration; const scalar = 3; 
        const emojiShape = confetti.shapeFromText({ text: emojiIcon, scalar });
        (function frame() {
            if (Date.now() > end) return;
            if (Math.random() < 0.1) {
                confetti({
                    particleCount: 1, startVelocity: 0, ticks: 200, origin: { x: Math.random(), y: -0.1 },
                    shapes: [emojiShape], scalar: scalar, gravity: 0.8, drift: 0, flat: true, colors: ['#FFF'] 
                });
            }
            requestAnimationFrame(frame);
        }());
    }

    // --- FUNCI√ìN RESPONSIVE DE C√ÅMARA ---
    function adjustCamera() {
        const aspect = window.innerWidth / window.innerHeight;
        // Si es formato vertical (celular), alejamos la c√°mara (Z mayor)
        if (aspect < 1) {
            camera.position.set(0, 0, 24); // Zoom out en celular
        } else {
            camera.position.set(0, 0, 16); // Normal en PC
        }
    }

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth/window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
        adjustCamera(); // Recalcular al rotar pantalla
    });

</script>
</body>
</html>
